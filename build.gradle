version '0.1' + '.' + (System.getenv("BUILD_NUMBER") ?: 'dev')


apply plugin: 'docker'


buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'se.transmode.gradle:gradle-docker:1.2'
    }
}


docker {
    registry = 'https://docker-registry.newsriver.io:5000'

}


task clean() {
    delete "build"
}


task buildimage(type: Docker, dependsOn: [clean]) {
    tagVersion = 'latest'
    registry = 'docker-registry.newsriver.io:5000'
    applicationName = 'newsriver-website'
    dockerfile = project.file('Dockerfile')
    push = true
    doFirst {
        copy {
            from 'public-html/'
            into "$stageDir/public-html/"
        }
    }
}